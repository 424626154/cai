var GameBg=function(e){function t(){e.call(this),this.items=new Array,this.initBg(),this.initGame()}__extends(t,e);var i=(__define,t);return p=i.prototype,p.initBg=function(){var e=new egret.Shape;e.graphics.beginFill(16777215),e.graphics.drawRect(0,0,GameData.getBgWidth(),GameData.getBgHeight()),e.graphics.endFill(),this.addChild(e),this.gameSprite=new egret.Sprite,this.gameSprite.width=GameData.getBgWidth(),this.gameSprite.height=GameData.getBgHeight(),this.addChild(this.gameSprite);for(var t=GameData.getBgWidth()/GameData.column,i=GameData.getBgHeight()/GameData.row,a=0;a<GameData.row;a++)for(var r=0;r<GameData.column;r++){var s=new egret.Shape;s.graphics.beginFill(0),s.graphics.drawRoundRect(a*t,r*i,t,i,10,10),s.graphics.endFill(),this.gameSprite.addChild(s);var h=new egret.Shape;h.graphics.beginFill(13434879),h.graphics.drawRoundRect(a*t+1,r*i+1,t-2,i-2,10,10),h.graphics.endFill(),this.gameSprite.addChild(h)}this.bar=new egret.Shape,this.addChild(this.bar),this.refreshBar()},p.initGame=function(){for(var e=0;e<GameData.column-1;e++)this.addRow(e);GameData.game_state=1,this.timerText=new egret.TextField,this.timerText.textAlign=egret.HorizontalAlign.CENTER,this.timerText.verticalAlign=egret.VerticalAlign.MIDDLE,this.timerText.fontFamily="Arial",this.timerText.textColor=16711680,this.timerText.size=60,this.timerText.text="",this.timerText.width=GameData.getBgWidth(),this.timerText.height=80,this.timerText.x=0,this.timerText.y=20,this.addChild(this.timerText),this.startSprite=new egret.Sprite,this.addChild(this.startSprite);var t=new egret.Shape;t.graphics.beginFill(0,.5),t.graphics.drawRect(0,0,GameData.getBgWidth(),GameData.getBgHeight()),t.graphics.endFill(),this.startSprite.addChild(t);var i=new egret.TextField;i.textAlign=egret.HorizontalAlign.CENTER,i.verticalAlign=egret.VerticalAlign.MIDDLE,i.background=!0,i.backgroundColor=16777215,i.border=!0,i.borderColor=0,i.fontFamily="Arial",i.textColor=0,i.size=30,i.text="开始游戏",i.width=200,i.height=80,i.x=(GameData.getBgWidth()-i.width)/2,i.y=(GameData.getBgHeight()-i.height)/2,this.startSprite.addChild(i),i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclikSatrt,this),this.timer=new egret.Timer(1,0),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this)},p.addRow=function(e){for(var t=new Array(!0,!1,!1,!1),i=0;i<GameData.row;i++){var a=GameData.random(0,t.length),r=t[a];t.splice(a,1);var s=new ItemSprite;s.setPos(i,e,r,this),this.gameSprite.addChild(s),this.items.push(s)}},p.move=function(e){for(var t=this.items.length-1;t>=0;t--){var i=this.items[t];i.pos_y==GameData.column-1?(this.gameSprite.removeChild(i),this.items.splice(t,1)):i.move(e)}this.addRow(0)},p.refreshTimer=function(){this.timerText.text=GameData.time_count/1e3+"''"},p.refreshBar=function(){var e=new Array(15497593,15425889,15352643,15213090,15075336),t=e[4];GameData.score<=10?t=e[0]:GameData.score<=20?t=e[1]:GameData.score<=30?t=e[2]:GameData.score<=40&&(t=e[3]);var i=GameData.getBgWidth()*GameData.score/GameData.max_score;this.bar.graphics.beginFill(t),this.bar.graphics.drawRoundRect(0,0,i,10,10,10),this.bar.graphics.endFill(),GameData.score>=GameData.max_score&&this.endGame()},p.onclikSatrt=function(){GameData.game_state=2,this.removeChild(this.startSprite),this.timer.start()},p.onclikEnd=function(){GameData.game_state=2,GameData.score=0,GameData.time_count=0,this.refreshTimer(),this.bar.graphics.clear(),this.refreshBar();for(var e=this.items.length-1;e>=0;e--){var t=this.items[e];this.gameSprite.removeChild(t),this.items.splice(e,1)}for(var i=0;i<GameData.column-1;i++)this.addRow(i);this.removeChild(this.endSprite),this.timer.start()},p.timerFunc=function(){GameData.time_count+=1,this.refreshTimer()},p.endGame=function(){GameData.game_state=3,this.timer.stop(),this.endSprite=new egret.Sprite,this.addChild(this.endSprite);var e=new egret.Shape;e.graphics.beginFill(0,.5),e.graphics.drawRect(0,0,GameData.getBgWidth(),GameData.getBgHeight()),e.graphics.endFill(),this.endSprite.addChild(e);var t=new egret.TextField;t.textAlign=egret.HorizontalAlign.CENTER,t.verticalAlign=egret.VerticalAlign.MIDDLE,t.background=!0,t.backgroundColor=16777215,t.border=!0,t.borderColor=0,t.fontFamily="Arial",t.textColor=0,t.size=30,t.text="重新开始",t.width=200,t.height=80,t.x=(GameData.getBgWidth()-t.width)/2,t.y=(GameData.getBgHeight()-t.height)/2,this.endSprite.addChild(t),t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclikEnd,this),this.timerText.text="";var i=new egret.TextField;i.textAlign=egret.HorizontalAlign.CENTER,i.verticalAlign=egret.VerticalAlign.MIDDLE,i.fontFamily="Arial",i.textColor=16711680,i.size=80,i.text=GameData.time_count/1e3+"''",i.width=GameData.getBgWidth(),i.height=80,i.x=0,i.y=(GameData.getBgHeight()-t.height)/2-120,this.endSprite.addChild(i)},t}(egret.Sprite);egret.registerClass(GameBg,"GameBg");var GameData=function(){function e(){}var t=(__define,e);return p=t.prototype,e.getBgWidth=function(){return 0==e.bgWidth&&(e.bgWidth=egret.MainContext.instance.stage.stageWidth),e.bgWidth},e.getBgHeight=function(){return 0==e.bgHeight&&(e.bgHeight=egret.MainContext.instance.stage.stageHeight),e.bgHeight},e.random=function(e,t){return Math.floor(e+Math.random()*(t-e))},e.bgWidth=0,e.bgHeight=0,e.row=4,e.column=4,e.clik_y=2,e.score=0,e.max_score=50,e.game_state=0,e.time_count=0,e}();egret.registerClass(GameData,"GameData");var ItemSprite=function(e){function t(){e.call(this),this.pos_x=0,this.pos_y=0,this.select_color1=1248270,this.select_color2=16777215,this.select_color3=13883348,this.select_color4=15679798,this.clik=!1,this.init()}__extends(t,e);var i=(__define,t);return p=i.prototype,p.init=function(){this.w=GameData.getBgWidth()/GameData.column,this.h=GameData.getBgHeight()/GameData.row,this.bg=new egret.Shape,this.bg.graphics.beginFill(0),this.bg.graphics.drawRoundRect(0,0,this.w,this.h,10,10),this.bg.graphics.endFill(),this.addChild(this.bg),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclik,this),this.bg1=new egret.Shape,this.bg1.graphics.beginFill(0),this.bg1.graphics.drawRoundRect(1,1,this.w-2,this.h-2,10,10),this.bg1.graphics.endFill(),this.addChild(this.bg1)},p.onclik=function(){2==GameData.game_state&&this.pos_y==GameData.clik_y&&(this.select||this.gameBg.endGame(),this.gameBg.move(this.pos_x))},p.setPos=function(e,t,i,a){this.pos_x=e,this.pos_y=t,this.select=i,this.gameBg=a,this.refreshBg(),this.refreshPos()},p.refreshPos=function(){this.x=this.pos_x*this.w,this.y=this.pos_y*this.h},p.refreshBg=function(){this.bg1.graphics.beginFill(this.clik?this.select?this.select_color3:this.select_color4:this.select?this.select_color1:this.select_color2),this.bg1.graphics.drawRoundRect(1,1,this.w-2,this.h-2,10,10),this.bg1.graphics.endFill()},p.move=function(e){this.pos_y+=1,this.pos_x==e&&this.pos_y==GameData.column-1&&(this.clik=!0,this.select&&(GameData.score+=1,this.gameBg.refreshBar())),this.refreshPos(),this.refreshBg()},t}(egret.Sprite);egret.registerClass(ItemSprite,"ItemSprite");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t);return p=i.prototype,p.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},p.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t);return p=i.prototype,p.onAddToStage=function(){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},p.onConfigComplete=function(){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup("preload")},p.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.createGameScene())},p.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},p.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},p.createGameScene=function(){var e=new GameBg;this.addChild(e)},p.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},p.startAnimation=function(e){for(var t=this,i=new egret.HtmlTextParser,a=[],r=0;r<e.length;r++)a.push(i.parser(e[r]));var s=t.textfield,h=-1,n=function(){h++,h>=a.length&&(h=0);var e=a[h];t.changeDescription(s,e);var i=egret.Tween.get(s);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(n,t)};n()},p.changeDescription=function(e,t){e.textFlow=t},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");